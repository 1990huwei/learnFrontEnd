# 第5天：网页性能优化基础学习指南

## 学习目标
- 理解网页性能的重要性和影响因素
- 掌握Core Web Vitals核心指标
- 学习HTML层面的性能优化技术
- 了解资源加载优化策略
- 能够使用性能监控工具进行分析
- 实现基本的性能优化方案

## 学习时长
- **总时长**: 2-3小时
- **上午理论学习**: 1.5小时
- **下午实践练习**: 1.5小时

## 前置知识
- 熟悉HTML5基础语法和语义化标签
- 了解Web标准和SEO优化基础
- 掌握基本的网页结构创建
- 理解浏览器的基本工作原理

## 理论知识学习

### 1. 网页性能基础概念

**什么是网页性能？**
- 网页性能是指网站加载速度、响应时间和用户体验的综合表现
- 包括页面加载时间、交互响应速度、视觉稳定性等多个维度
- 直接影响用户体验、搜索引擎排名和业务转化率

**性能的重要性：**
1. **用户体验**：快速加载提升用户满意度和留存率
2. **SEO影响**：Google将页面速度作为排名因素
3. **转化率**：页面加载时间每增加1秒，转化率可能下降7%
4. **移动端体验**：移动设备对性能更加敏感
5. **成本效益**：减少服务器负载和带宽消耗

**性能影响因素：**
- **网络延迟**：服务器响应时间、CDN配置
- **资源大小**：HTML、CSS、JavaScript、图片文件大小
- **资源数量**：HTTP请求数量
- **渲染阻塞**：CSS和JavaScript的加载和执行
- **设备性能**：用户设备的处理能力

### 2. Core Web Vitals核心指标

**什么是Core Web Vitals？**
Core Web Vitals是Google提出的三个核心用户体验指标，用于衡量网页的加载性能、交互性和视觉稳定性。

**LCP (Largest Contentful Paint) - 最大内容绘制**
- **定义**：页面主要内容完成渲染的时间
- **测量对象**：最大的文本块或图像元素
- **良好标准**：≤ 2.5秒
- **需要改进**：2.5-4.0秒
- **较差**：> 4.0秒

```html
<!-- 影响LCP的元素示例 -->
<main>
    <!-- 这个大图片可能是LCP元素 -->
    <img src="hero-image.jpg" alt="主要内容图片" width="800" height="400">
    
    <!-- 或者这个大文本块 -->
    <section>
        <h1>页面主标题</h1>
        <p>大段的主要内容文本...</p>
    </section>
</main>
```

**FID (First Input Delay) - 首次输入延迟**
- **定义**：用户首次与页面交互到浏览器响应的时间
- **测量对象**：点击、触摸、按键等交互
- **良好标准**：≤ 100毫秒
- **需要改进**：100-300毫秒
- **较差**：> 300毫秒

**CLS (Cumulative Layout Shift) - 累积布局偏移**
- **定义**：页面加载过程中元素位置意外移动的程度
- **测量方法**：影响分数 × 距离分数
- **良好标准**：≤ 0.1
- **需要改进**：0.1-0.25
- **较差**：> 0.25

```html
<!-- 避免CLS的示例 -->
<!-- 不好的做法：没有指定图片尺寸 -->
<img src="image.jpg" alt="示例图片">

<!-- 好的做法：指定图片尺寸 -->
<img src="image.jpg" alt="示例图片" width="400" height="300">

<!-- 或者使用CSS预留空间 -->
<div style="aspect-ratio: 4/3; background: #f0f0f0;">
    <img src="image.jpg" alt="示例图片" style="width: 100%; height: 100%; object-fit: cover;">
</div>
```

### 3. HTML层面的性能优化

**文档结构优化**

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 关键CSS内联，减少渲染阻塞 -->
    <style>
        /* 关键路径CSS - 首屏必需的样式 */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            line-height: 1.6;
        }
        .header { 
            background: #007bff;
            color: white;
            padding: 1rem;
        }
        .hero { 
            min-height: 400px;
            background: #f8f9fa;
        }
    </style>
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/images/hero-image.jpg" as="image">
    
    <!-- DNS预解析 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//api.example.com">
    
    <!-- 预连接重要的第三方域名 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <title>高性能网页示例</title>
    
    <!-- 非关键CSS异步加载 -->
    <link rel="preload" href="/css/non-critical.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/non-critical.css"></noscript>
</head>
<body>
    <!-- 页面内容 -->
    <header class="header">
        <h1>网站标题</h1>
    </header>
    
    <main>
        <section class="hero">
            <!-- 使用适当的图片格式和尺寸 -->
            <picture>
                <source media="(min-width: 768px)" srcset="hero-large.webp" type="image/webp">
                <source media="(min-width: 768px)" srcset="hero-large.jpg">
                <source srcset="hero-small.webp" type="image/webp">
                <img src="hero-small.jpg" alt="主要内容图片" width="800" height="400" loading="eager">
            </picture>
        </section>
    </main>
    
    <!-- JavaScript放在body底部，避免阻塞渲染 -->
    <script src="/js/critical.js"></script>
    
    <!-- 非关键JavaScript异步加载 -->
    <script async src="/js/analytics.js"></script>
    <script defer src="/js/non-critical.js"></script>
</body>
</html>
```

### 练习2：性能测试和优化报告

**任务：使用浏览器开发者工具分析网页性能，并创建优化报告**

1. **使用Chrome DevTools进行性能分析**

```html
<!-- 创建一个需要优化的页面 performance-test.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能测试页面</title>
    
    <!-- 故意添加一些性能问题用于测试 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=block">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .image-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .image-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .heavy-animation {
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>性能测试页面</h1>
        <p>这个页面包含一些性能问题，用于测试和优化。</p>
        
        <!-- 大量未优化的图片 -->
        <div class="image-grid">
            <div class="image-item">
                <img src="https://picsum.photos/800/600?random=1" alt="测试图片1">
            </div>
            <div class="image-item">
                <img src="https://picsum.photos/800/600?random=2" alt="测试图片2">
            </div>
            <div class="image-item">
                <img src="https://picsum.photos/800/600?random=3" alt="测试图片3">
            </div>
            <div class="image-item">
                <img src="https://picsum.photos/800/600?random=4" alt="测试图片4">
            </div>
            <div class="image-item">
                <img src="https://picsum.photos/800/600?random=5" alt="测试图片5">
            </div>
            <div class="image-item">
                <img src="https://picsum.photos/800/600?random=6" alt="测试图片6">
            </div>
        </div>
        
        <!-- 一些会导致布局偏移的内容 -->
        <div id="dynamic-content"></div>
        
        <!-- 重动画元素 -->
        <div class="heavy-animation" style="width: 100px; height: 100px; background: #007bff; margin: 20px auto;"></div>
    </div>
    
    <!-- 阻塞渲染的JavaScript -->
    <script>
        // 模拟重计算
        function heavyCalculation() {
            let result = 0;
            for (let i = 0; i < 1000000; i++) {
                result += Math.random();
            }
            return result;
        }
        
        // 导致布局偏移的动态内容
        setTimeout(() => {
            document.getElementById('dynamic-content').innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <h2>动态加载的内容</h2>
                    <p>这个内容是延迟加载的，可能会导致布局偏移（CLS）。</p>
                    <p>计算结果：${heavyCalculation()}</p>
                </div>
            `;
        }, 2000);
        
        // 模拟长任务
        setTimeout(() => {
            const start = performance.now();
            while (performance.now() - start < 100) {
                // 阻塞主线程100ms
            }
        }, 1000);
    </script>
</body>
</html>
```

2. **性能分析步骤**

**Chrome DevTools使用指南：**

1. **打开开发者工具**
   - 按F12或右键选择"检查"
   - 切换到"Performance"（性能）标签

2. **录制性能**
   - 点击录制按钮（圆形图标）
   - 刷新页面或执行操作
   - 停止录制

3. **分析结果**
   - 查看FCP、LCP、FID、CLS指标
   - 分析主线程活动
   - 检查网络请求
   - 查看渲染性能

4. **Lighthouse审计**
   - 切换到"Lighthouse"标签
   - 选择"Performance"类别
   - 点击"Generate report"
   - 分析得分和建议

**性能优化报告模板：**

```markdown
# 网页性能优化报告

## 页面信息
- **页面URL**: performance-test.html
- **测试时间**: 2024年X月X日
- **测试环境**: Chrome浏览器，桌面设备

## 性能指标

### Core Web Vitals
- **LCP (最大内容绘制)**: X.X秒
- **FID (首次输入延迟)**: X毫秒
- **CLS (累积布局偏移)**: X.XX

### 其他指标
- **FCP (首次内容绘制)**: X.X秒
- **TTI (可交互时间)**: X.X秒
- **总阻塞时间**: X毫秒
- **速度指数**: X.X

## 发现的问题

### 1. 图片优化问题
- **问题**: 图片未进行格式优化和尺寸优化
- **影响**: 增加加载时间和带宽消耗
- **解决方案**: 
  - 使用WebP格式
  - 实现响应式图片
  - 添加懒加载

### 2. 字体加载问题
- **问题**: 字体加载阻塞渲染
- **影响**: 延迟首次内容绘制
- **解决方案**: 
  - 使用font-display: swap
  - 预加载关键字体

### 3. 布局偏移问题
- **问题**: 动态内容导致布局偏移
- **影响**: CLS分数较高
- **解决方案**: 
  - 为动态内容预留空间
  - 指定图片尺寸

### 4. JavaScript性能问题
- **问题**: 长任务阻塞主线程
- **影响**: 影响交互响应
- **解决方案**: 
  - 代码分割
  - 使用Web Workers
  - 优化算法

## 优化建议

### 高优先级
1. 实现图片懒加载和格式优化
2. 优化字体加载策略
3. 修复布局偏移问题

### 中优先级
1. 优化JavaScript执行
2. 实现资源预加载
3. 启用压缩和缓存

### 低优先级
1. 进一步优化CSS
2. 实现Service Worker缓存
3. 考虑CDN部署

## 预期改进
- **LCP改进**: 减少1-2秒
- **CLS改进**: 降低到0.1以下
- **整体性能分数**: 提升20-30分
```

### 练习3：创建性能监控仪表板

**任务：创建一个简单的性能监控页面，实时显示性能指标**

创建`performance-dashboard.html`文件：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能监控仪表板</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .metric-good { color: #28a745; }
        .metric-needs-improvement { color: #ffc107; }
        .metric-poor { color: #dc3545; }
        
        .details-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .recommendations {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .recommendation-item {
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>网页性能监控仪表板</h1>
        
        <!-- Core Web Vitals指标 -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">LCP (最大内容绘制)</div>
                <div id="lcp-value" class="metric-value">-</div>
                <div class="metric-label">目标: ≤ 2.5秒</div>
                <div class="progress-bar">
                    <div id="lcp-progress" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">FID (首次输入延迟)</div>
                <div id="fid-value" class="metric-value">-</div>
                <div class="metric-label">目标: ≤ 100毫秒</div>
                <div class="progress-bar">
                    <div id="fid-progress" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">CLS (累积布局偏移)</div>
                <div id="cls-value" class="metric-value">-</div>
                <div class="metric-label">目标: ≤ 0.1</div>
                <div class="progress-bar">
                    <div id="cls-progress" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">FCP (首次内容绘制)</div>
                <div id="fcp-value" class="metric-value">-</div>
                <div class="metric-label">目标: ≤ 1.8秒</div>
                <div class="progress-bar">
                    <div id="fcp-progress" class="progress-fill"></div>
                </div>
            </div>
        </div>
        
        <!-- 详细性能信息 -->
        <div class="details-section">
            <h2>详细性能指标</h2>
            <div id="performance-details">
                <p>正在收集性能数据...</p>
            </div>
        </div>
        
        <!-- 优化建议 -->
        <div class="details-section">
            <h2>优化建议</h2>
            <div id="recommendations" class="recommendations">
                <p>正在分析性能数据...</p>
            </div>
        </div>
    </div>
    
    <script>
        class PerformanceDashboard {
            constructor() {
                this.metrics = {
                    lcp: null,
                    fid: null,
                    cls: 0,
                    fcp: null
                };
                
                this.init();
            }
            
            init() {
                this.setupObservers();
                this.collectBasicMetrics();
                this.updateDisplay();
            }
            
            setupObservers() {
                if ('PerformanceObserver' in window) {
                    // LCP观察器
                    new PerformanceObserver((entryList) => {
                        const entries = entryList.getEntries();
                        const lastEntry = entries[entries.length - 1];
                        this.metrics.lcp = lastEntry.startTime;
                        this.updateMetric('lcp', this.metrics.lcp);
                    }).observe({entryTypes: ['largest-contentful-paint']});
                    
                    // FID观察器
                    new PerformanceObserver((entryList) => {
                        for (const entry of entryList.getEntries()) {
                            this.metrics.fid = entry.processingStart - entry.startTime;
                            this.updateMetric('fid', this.metrics.fid);
                        }
                    }).observe({entryTypes: ['first-input']});
                    
                    // CLS观察器
                    new PerformanceObserver((entryList) => {
                        for (const entry of entryList.getEntries()) {
                            if (!entry.hadRecentInput) {
                                this.metrics.cls += entry.value;
                            }
                        }
                        this.updateMetric('cls', this.metrics.cls);
                    }).observe({entryTypes: ['layout-shift']});
                    
                    // FCP观察器
                    new PerformanceObserver((entryList) => {
                        for (const entry of entryList.getEntries()) {
                            if (entry.name === 'first-contentful-paint') {
                                this.metrics.fcp = entry.startTime;
                                this.updateMetric('fcp', this.metrics.fcp);
                            }
                        }
                    }).observe({entryTypes: ['paint']});
                }
            }
            
            collectBasicMetrics() {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        this.updatePerformanceDetails(perfData);
                        this.generateRecommendations();
                    }, 1000);
                });
            }
            
            updateMetric(type, value) {
                const valueElement = document.getElementById(`${type}-value`);
                const progressElement = document.getElementById(`${type}-progress`);
                
                let displayValue, progressPercent, className;
                
                switch(type) {
                    case 'lcp':
                        displayValue = `${(value / 1000).toFixed(2)}s`;
                        progressPercent = Math.min((value / 1000) / 4 * 100, 100);
                        className = value <= 2500 ? 'metric-good' : value <= 4000 ? 'metric-needs-improvement' : 'metric-poor';
                        break;
                    case 'fid':
                        displayValue = `${value.toFixed(0)}ms`;
                        progressPercent = Math.min(value / 300 * 100, 100);
                        className = value <= 100 ? 'metric-good' : value <= 300 ? 'metric-needs-improvement' : 'metric-poor';
                        break;
                    case 'cls':
                        displayValue = value.toFixed(3);
                        progressPercent = Math.min(value / 0.25 * 100, 100);
                        className = value <= 0.1 ? 'metric-good' : value <= 0.25 ? 'metric-needs-improvement' : 'metric-poor';
                        break;
                    case 'fcp':
                        displayValue = `${(value / 1000).toFixed(2)}s`;
                        progressPercent = Math.min((value / 1000) / 3 * 100, 100);
                        className = value <= 1800 ? 'metric-good' : value <= 3000 ? 'metric-needs-improvement' : 'metric-poor';
                        break;
                }
                
                valueElement.textContent = displayValue;
                valueElement.className = `metric-value ${className}`;
                progressElement.style.width = `${progressPercent}%`;
                progressElement.style.backgroundColor = className === 'metric-good' ? '#28a745' : 
                                                       className === 'metric-needs-improvement' ? '#ffc107' : '#dc3545';
            }
            
            updatePerformanceDetails(perfData) {
                const detailsElement = document.getElementById('performance-details');
                
                const details = {
                    'DNS查询时间': `${(perfData.domainLookupEnd - perfData.domainLookupStart).toFixed(0)}ms`,
                    'TCP连接时间': `${(perfData.connectEnd - perfData.connectStart).toFixed(0)}ms`,
                    '请求响应时间': `${(perfData.responseEnd - perfData.requestStart).toFixed(0)}ms`,
                    'DOM解析时间': `${(perfData.domContentLoadedEventEnd - perfData.domLoading).toFixed(0)}ms`,
                    '页面完全加载时间': `${(perfData.loadEventEnd - perfData.navigationStart).toFixed(0)}ms`,
                    '资源加载时间': `${(perfData.loadEventStart - perfData.domContentLoadedEventEnd).toFixed(0)}ms`
                };
                
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
                
                for (const [label, value] of Object.entries(details)) {
                    html += `
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 4px;">
                            <div style="font-weight: bold; color: #333;">${label}</div>
                            <div style="font-size: 1.2rem; color: #007bff;">${value}</div>
                        </div>
                    `;
                }
                
                html += '</div>';
                detailsElement.innerHTML = html;
            }
            
            generateRecommendations() {
                const recommendationsElement = document.getElementById('recommendations');
                const recommendations = [];
                
                if (this.metrics.lcp > 2500) {
                    recommendations.push('优化LCP：使用图片预加载、优化服务器响应时间、减少渲染阻塞资源');
                }
                
                if (this.metrics.fid > 100) {
                    recommendations.push('优化FID：减少JavaScript执行时间、使用代码分割、优化第三方脚本');
                }
                
                if (this.metrics.cls > 0.1) {
                    recommendations.push('优化CLS：为图片和广告预留空间、避免在现有内容上方插入内容');
                }
                
                if (this.metrics.fcp > 1800) {
                    recommendations.push('优化FCP：内联关键CSS、优化字体加载、减少服务器响应时间');
                }
                
                if (recommendations.length === 0) {
                    recommendations.push('恭喜！您的网页性能表现良好，继续保持！');
                }
                
                let html = '';
                recommendations.forEach(rec => {
                    html += `<div class="recommendation-item">${rec}</div>`;
                });
                
                recommendationsElement.innerHTML = html;
            }
            
            updateDisplay() {
                // 定期更新显示
                setInterval(() => {
                    this.updateMetric('cls', this.metrics.cls);
                }, 1000);
            }
        }
        
        // 初始化仪表板
        document.addEventListener('DOMContentLoaded', () => {
            new PerformanceDashboard();
        });
    </script>
</body>
</html>
```

## 学习检查点

完成今天的学习后，您应该能够：

### 理论知识检查
- [ ] 解释什么是Core Web Vitals及其重要性
- [ ] 说明LCP、FID、CLS三个指标的含义和标准
- [ ] 理解网页性能对用户体验和SEO的影响
- [ ] 掌握HTML层面的性能优化策略

### 实践技能检查
- [ ] 能够使用资源提示指令（preload、prefetch、preconnect等）
- [ ] 实现响应式图片和懒加载
- [ ] 优化CSS和JavaScript的加载策略
- [ ] 使用浏览器开发者工具分析性能
- [ ] 创建基本的性能监控代码

### 代码实现检查
- [ ] 创建了性能优化的产品展示页面
- [ ] 完成了性能测试和分析
- [ ] 实现了性能监控仪表板
- [ ] 能够识别和修复常见的性能问题

## 常见问题解答

### Q1: 什么时候应该使用preload vs prefetch？
**A**: 
- **preload**: 用于当前页面必需的关键资源（如关键CSS、字体、首屏图片）
- **prefetch**: 用于未来页面可能需要的资源（如下一页的内容、非关键图片）

### Q2: 如何选择合适的图片格式？
**A**: 
- **WebP**: 现代浏览器的首选，体积小，质量好
- **AVIF**: 最新格式，压缩率更高，但支持有限
- **JPEG**: 照片类图片的传统选择
- **PNG**: 需要透明背景的图片
- **SVG**: 图标和简单图形

### Q3: 为什么我的CLS分数很高？
**A**: 常见原因包括：
- 图片没有指定尺寸
- 动态插入内容没有预留空间
- 字体加载导致文本重排
- 广告或嵌入内容尺寸不确定

### Q4: 如何优化JavaScript性能？
**A**: 
- 使用async和defer属性
- 实现代码分割
- 避免长任务（>50ms）
- 使用Web Workers处理重计算
- 优化算法和数据结构

### Q5: 移动端性能优化有什么特殊考虑？
**A**: 
- 网络条件较差，更需要优化资源大小
- 设备性能有限，避免复杂动画和计算
- 触摸交互的响应时间更重要
- 考虑使用Service Worker进行缓存

### Q6: 如何平衡性能和功能？
**A**: 
- 优先优化关键路径
- 使用渐进式加载
- 实现功能的懒加载
- 提供降级方案
- 根据用户设备和网络条件调整

## 参考资源

### 官方文档
- [Web Vitals](https://web.dev/vitals/)
- [Core Web Vitals](https://web.dev/core-web-vitals/)
- [Performance API](https://developer.mozilla.org/en-US/docs/Web/API/Performance)
- [Resource Hints](https://www.w3.org/TR/resource-hints/)

### 性能工具
- [Google PageSpeed Insights](https://pagespeed.web.dev/)
- [GTmetrix](https://gtmetrix.com/)
- [WebPageTest](https://www.webpagetest.org/)
- [Chrome DevTools](https://developers.google.com/web/tools/chrome-devtools)

### 学习资源
- [Web.dev Performance](https://web.dev/performance/)
- [MDN Performance](https://developer.mozilla.org/en-US/docs/Web/Performance)
- [Google Developers - Performance](https://developers.google.com/web/fundamentals/performance)

### 图片优化工具
- [Squoosh](https://squoosh.app/) - 在线图片压缩
- [ImageOptim](https://imageoptim.com/) - 图片优化工具
- [TinyPNG](https://tinypng.com/) - PNG/JPEG压缩

### 性能监控服务
- [Google Analytics](https://analytics.google.com/)
- [Real User Monitoring (RUM)](https://web.dev/user-centric-performance-metrics/)
- [Lighthouse CI](https://github.com/GoogleChrome/lighthouse-ci)

## 下一步学习

明天我们将学习**现代HTML工具和工作流**，内容包括：
- HTML验证和代码质量工具
- 现代HTML开发工作流
- 自动化工具和构建流程
- HTML模板引擎基础
- 组件化开发思想

请确保今天的性能优化概念已经理解，特别是Core Web Vitals的测量和优化方法，这将为后续的工具链学习打下基础。

**资源提示指令详解**

```html
<!-- DNS预解析：提前解析域名 -->
<link rel="dns-prefetch" href="//example.com">

<!-- 预连接：建立完整连接（DNS + TCP + TLS） -->
<link rel="preconnect" href="https://fonts.googleapis.com">

<!-- 预加载：高优先级获取当前页面需要的资源 -->
<link rel="preload" href="/critical.css" as="style">
<link rel="preload" href="/hero-image.jpg" as="image">
<link rel="preload" href="/main-font.woff2" as="font" type="font/woff2" crossorigin>

<!-- 预获取：低优先级获取未来可能需要的资源 -->
<link rel="prefetch" href="/next-page.html">
<link rel="prefetch" href="/images/gallery-1.jpg">

<!-- 模块预加载：预加载ES模块 -->
<link rel="modulepreload" href="/js/app.js">
```

### 4. 图片优化策略

**响应式图片**

```html
<!-- 使用srcset提供不同分辨率的图片 -->
<img src="image-400.jpg" 
     srcset="image-400.jpg 400w,
             image-800.jpg 800w,
             image-1200.jpg 1200w"
     sizes="(max-width: 600px) 400px,
            (max-width: 1000px) 800px,
            1200px"
     alt="响应式图片示例"
     width="800"
     height="600">

<!-- 使用picture元素提供不同格式的图片 -->
<picture>
    <!-- 现代浏览器优先使用WebP格式 -->
    <source srcset="image-400.webp 400w,
                    image-800.webp 800w,
                    image-1200.webp 1200w"
            sizes="(max-width: 600px) 400px,
                   (max-width: 1000px) 800px,
                   1200px"
            type="image/webp">
    
    <!-- AVIF格式支持（更新的格式） -->
    <source srcset="image-400.avif 400w,
                    image-800.avif 800w,
                    image-1200.avif 1200w"
            sizes="(max-width: 600px) 400px,
                   (max-width: 1000px) 800px,
                   1200px"
            type="image/avif">
    
    <!-- 回退到JPEG格式 -->
    <img src="image-800.jpg"
         srcset="image-400.jpg 400w,
                 image-800.jpg 800w,
                 image-1200.jpg 1200w"
         sizes="(max-width: 600px) 400px,
                (max-width: 1000px) 800px,
                1200px"
         alt="多格式响应式图片"
         width="800"
         height="600">
</picture>
```

**图片懒加载**

```html
<!-- 原生懒加载（现代浏览器支持） -->
<img src="placeholder.jpg" 
     data-src="actual-image.jpg" 
     alt="懒加载图片"
     loading="lazy"
     width="400"
     height="300">

<!-- 首屏图片应该立即加载 -->
<img src="hero-image.jpg" 
     alt="首屏重要图片"
     loading="eager"
     width="800"
     height="400">

<!-- 使用Intersection Observer的懒加载实现 -->
<img class="lazy-image" 
     src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E"
     data-src="real-image.jpg"
     alt="懒加载图片示例"
     width="400"
     height="300">
```

**图片格式选择指南**

```html
<!-- 不同用途的图片格式选择 -->

<!-- 照片类图片：使用JPEG或WebP -->
<picture>
    <source srcset="photo.webp" type="image/webp">
    <img src="photo.jpg" alt="照片" width="600" height="400">
</picture>

<!-- 图标和简单图形：使用SVG -->
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 2L2 7V10C2 16 6 20.5 12 22C18 20.5 22 16 22 10V7L12 2Z" stroke="currentColor" stroke-width="2"/>
</svg>

<!-- 需要透明背景的图片：使用PNG或WebP -->
<picture>
    <source srcset="logo.webp" type="image/webp">
    <img src="logo.png" alt="公司标志" width="200" height="100">
</picture>

<!-- 动画：使用优化的GIF或WebP动画 -->
<picture>
    <source srcset="animation.webp" type="image/webp">
    <img src="animation.gif" alt="动画效果" width="300" height="200">
</picture>
```

### 5. 脚本和样式优化

**CSS优化策略**

```html
<head>
    <!-- 关键CSS内联 -->
    <style>
        /* 首屏必需的CSS */
        body { font-family: sans-serif; margin: 0; }
        .header { background: #333; color: white; padding: 1rem; }
        .hero { min-height: 50vh; }
    </style>
    
    <!-- 非关键CSS异步加载 -->
    <link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="styles.css"></noscript>
    
    <!-- 媒体查询优化 -->
    <link rel="stylesheet" href="print.css" media="print">
    <link rel="stylesheet" href="mobile.css" media="(max-width: 768px)">
</head>
```

**JavaScript优化策略**

```html
<!-- 脚本加载策略 -->

<!-- 关键脚本：同步加载（阻塞） -->
<script src="critical.js"></script>

<!-- 异步脚本：不阻塞HTML解析 -->
<script async src="analytics.js"></script>

<!-- 延迟脚本：HTML解析完成后执行 -->
<script defer src="app.js"></script>

<!-- 模块脚本：现代浏览器的模块化加载 -->
<script type="module" src="main.js"></script>
<script nomodule src="legacy.js"></script>

<!-- 内联脚本优化 -->
<script>
    // 关键的初始化代码
    window.APP_CONFIG = {
        apiUrl: 'https://api.example.com',
        version: '1.0.0'
    };
</script>
```

**资源加载优先级**

```html
<!-- 高优先级资源 -->
<link rel="preload" href="critical.css" as="style">
<link rel="preload" href="hero-image.jpg" as="image">
<link rel="preload" href="main-font.woff2" as="font" type="font/woff2" crossorigin>

<!-- 中等优先级资源 -->
<link rel="prefetch" href="secondary.css">
<link rel="prefetch" href="next-page.html">

<!-- 低优先级资源 -->
<script async src="non-critical.js"></script>
<link rel="prefetch" href="future-image.jpg">
```

### 6. 缓存策略

**HTML缓存控制**

```html
<!-- 通过meta标签控制缓存（有限效果） -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<!-- 更好的做法是在服务器端设置HTTP头 -->
<!-- 
Cache-Control: public, max-age=31536000  // 静态资源缓存1年
Cache-Control: no-cache                  // HTML文件不缓存
ETag: "abc123"                          // 实体标签
Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT
-->
```

**Service Worker缓存**

```html
<!-- 注册Service Worker -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('SW registered: ', registration);
                })
                .catch(function(registrationError) {
                    console.log('SW registration failed: ', registrationError);
                });
        });
    }
</script>
```

### 7. 性能监控和测量

**Web Vitals API使用**

```html
<script>
    // 监控Core Web Vitals
    function sendToAnalytics(metric) {
        // 发送数据到分析服务
        console.log(metric);
    }

    // 监控LCP
    new PerformanceObserver((entryList) => {
        for (const entry of entryList.getEntries()) {
            sendToAnalytics({
                name: 'LCP',
                value: entry.startTime,
                id: entry.id
            });
        }
    }).observe({entryTypes: ['largest-contentful-paint']});

    // 监控FID
    new PerformanceObserver((entryList) => {
        for (const entry of entryList.getEntries()) {
            sendToAnalytics({
                name: 'FID',
                value: entry.processingStart - entry.startTime,
                id: entry.name
            });
        }
    }).observe({entryTypes: ['first-input']});

    // 监控CLS
    let clsValue = 0;
    let clsEntries = [];

    new PerformanceObserver((entryList) => {
        for (const entry of entryList.getEntries()) {
            if (!entry.hadRecentInput) {
                clsValue += entry.value;
                clsEntries.push(entry);
            }
        }
    }).observe({entryTypes: ['layout-shift']});

    // 页面卸载时发送CLS数据
    addEventListener('beforeunload', () => {
        sendToAnalytics({
            name: 'CLS',
            value: clsValue,
            entries: clsEntries
        });
    });
</script>
```

**Performance API使用**

```html
<script>
    // 页面加载完成后测量性能
    window.addEventListener('load', function() {
        setTimeout(function() {
            const perfData = performance.getEntriesByType('navigation')[0];
            
            const metrics = {
                // DNS查询时间
                dnsTime: perfData.domainLookupEnd - perfData.domainLookupStart,
                
                // TCP连接时间
                tcpTime: perfData.connectEnd - perfData.connectStart,
                
                // 请求响应时间
                requestTime: perfData.responseEnd - perfData.requestStart,
                
                // DOM解析时间
                domParseTime: perfData.domContentLoadedEventEnd - perfData.domLoading,
                
                // 页面完全加载时间
                loadTime: perfData.loadEventEnd - perfData.navigationStart,
                
                // 首次内容绘制
                fcp: performance.getEntriesByName('first-contentful-paint')[0]?.startTime,
                
                // 首次有意义绘制
                fmp: performance.getEntriesByName('first-meaningful-paint')[0]?.startTime
            };
            
            console.log('Performance Metrics:', metrics);
            
            // 发送到分析服务
            // sendToAnalytics(metrics);
        }, 0);
    });
</script>
```

## 实践练习

### 练习1：创建高性能的产品展示页面

**任务：创建一个优化了性能的产品展示页面，应用所学的优化技术**

创建`performance-optimized-page.html`文件：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" as="style">
    <link rel="preload" href="/images/hero-product.webp" as="image">
    
    <!-- DNS预解析和预连接 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//images.unsplash.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <title>高性能智能手表 - 科技与时尚的完美结合 | TechStore</title>
    <meta name="description" content="体验最新的智能手表技术，集健康监测、智能通知、长续航于一体。现代设计，卓越性能，是您数字生活的完美伴侣。">
    
    <!-- 关键CSS内联 -->
    <style>
        /* 关键路径CSS - 首屏样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .header {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007bff;
        }
        
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 80vh;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
        }
        
        .hero-text h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .hero-text p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .cta-button {
            background: #ff6b6b;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s ease;
        }
        
        .cta-button:hover {
            transform: translateY(-2px);
        }
        
        .hero-image {
            position: relative;
        }
        
        .product-image {
            width: 100%;
            height: auto;
            max-width: 500px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .hero-text h1 {
                font-size: 2rem;
            }
            
            .nav {
                padding: 1rem;
            }
        }
        
        /* 加载动画 */
        .loading-placeholder {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
    
    <!-- 异步加载非关键CSS -->
    <link rel="preload" href="/css/non-critical.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/non-critical.css"></noscript>
    
    <!-- 字体异步加载 -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"></noscript>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">TechStore</div>
            <div class="nav-links">
                <a href="#products" style="margin-right: 2rem; text-decoration: none; color: #333;">产品</a>
                <a href="#about" style="margin-right: 2rem; text-decoration: none; color: #333;">关于</a>
                <a href="#contact" style="text-decoration: none; color: #333;">联系</a>
            </div>
        </nav>
    </header>
    
    <main>
        <section class="hero">
            <div class="hero-content">
                <div class="hero-text">
                    <h1>智能手表新时代</h1>
                    <p>集健康监测、智能通知、长续航于一体的革命性智能手表。现代设计，卓越性能，是您数字生活的完美伴侣。</p>
                    <a href="#buy" class="cta-button">立即购买 ¥1,999</a>
                </div>
                
                <div class="hero-image">
                    <!-- 使用picture元素提供多种格式 -->
                    <picture>
                        <!-- 现代浏览器优先使用WebP -->
                        <source 
                            srcset="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&fm=webp&q=80 400w,
                                    https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=600&fm=webp&q=80 600w,
                                    https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=800&fm=webp&q=80 800w"
                            sizes="(max-width: 768px) 100vw, 50vw"
                            type="image/webp">
                        
                        <!-- 回退到JPEG -->
                        <img 
                            src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=600&fm=jpg&q=80"
                            srcset="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&fm=jpg&q=80 400w,
                                    https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=600&fm=jpg&q=80 600w,
                                    https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=800&fm=jpg&q=80 800w"
                            sizes="(max-width: 768px) 100vw, 50vw"
                            alt="高性能智能手表产品图片，展示现代设计和精致工艺"
                            class="product-image"
                            width="500"
                            height="500"
                            loading="eager">
                    </picture>
                </div>
            </div>
        </section>
        
        <section style="padding: 4rem 2rem; max-width: 1200px; margin: 0 auto;">
            <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: #333;">产品特色</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div style="text-align: center; padding: 2rem; background: #f8f9fa; border-radius: 15px;">
                    <!-- SVG图标，体积小，可缩放 -->
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 1rem;">
                        <path d="M12 2L2 7V10C2 16 6 20.5 12 22C18 20.5 22 16 22 10V7L12 2Z" stroke="#007bff" stroke-width="2" fill="none"/>
                    </svg>
                    <h3 style="margin-bottom: 1rem; color: #333;">健康监测</h3>
                    <p style="color: #666;">24小时心率监测、血氧检测、睡眠分析，全方位守护您的健康。</p>
                </div>
                
                <div style="text-align: center; padding: 2rem; background: #f8f9fa; border-radius: 15px;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 1rem;">
                        <path d="M12 2C6.48 2 2 6.48 2 12S6.48 22 12 22 22 17.52 22 12 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="#007bff"/>
                    </svg>
                    <h3 style="margin-bottom: 1rem; color: #333;">智能通知</h3>
                    <p style="color: #666;">来电、短信、应用通知智能推送，重要信息不错过。</p>
                </div>
                
                <div style="text-align: center; padding: 2rem; background: #f8f9fa; border-radius: 15px;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 1rem;">
                        <path d="M15.67 4H14V2C14 1.45 13.55 1 13 1S12 1.45 12 2V4H8V2C8 1.45 7.55 1 7 1S6 1.45 6 2V4H4.33C3.6 4 3 4.6 3 5.33V19.67C3 20.4 3.6 21 4.33 21H15.67C16.4 21 17 20.4 17 19.67V5.33C17 4.6 16.4 4 15.67 4Z" fill="#007bff"/>
                    </svg>
                    <h3 style="margin-bottom: 1rem; color: #333;">长续航</h3>
                    <p style="color: #666;">7天超长续航，快速充电技术，让您告别电量焦虑。</p>
                </div>
            </div>
        </section>
        
        <!-- 懒加载的图片画廊 -->
        <section style="padding: 4rem 2rem; background: #f8f9fa;">
            <div style="max-width: 1200px; margin: 0 auto;">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: #333;">产品展示</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                    <!-- 懒加载图片 -->
                    <div style="border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <img 
                            class="lazy-image"
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3E加载中...%3C/text%3E%3C/svg%3E"
                            data-src="https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=400&fm=webp&q=80"
                            alt="智能手表侧面视图"
                            width="400"
                            height="300"
                            loading="lazy"
                            style="width: 100%; height: 250px; object-fit: cover;">
                    </div>
                    
                    <div style="border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <img 
                            class="lazy-image"
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3E加载中...%3C/text%3E%3C/svg%3E"
                            data-src="https://images.unsplash.com/photo-1508685096489-7aacd43bd3b1?w=400&fm=webp&q=80"
                            alt="智能手表运动模式界面"
                            width="400"
                            height="300"
                            loading="lazy"
                            style="width: 100%; height: 250px; object-fit: cover;">
                    </div>
                    
                    <div style="border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <img 
                            class="lazy-image"
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3E加载中...%3C/text%3E%3C/svg%3E"
                            data-src="https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=400&fm=webp&q=80"
                            alt="智能手表充电状态"
                            width="400"
                            height="300"
                            loading="lazy"
                            style="width: 100%; height: 250px; object-fit: cover;">
                    </div>
                    
                    <div style="border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <img 
                            class="lazy-image"
                            src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999'%3E加载中...%3C/text%3E%3C/svg%3E"
                            data-src="https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=400&fm=webp&q=80"
                            alt="智能手表配件展示"
                            width="400"
                            height="300"
                            loading="lazy"
                            style="width: 100%; height: 250px; object-fit: cover;">
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer style="background: #333; color: white; padding: 3rem 2rem; text-align: center;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <p style="margin-bottom: 1rem;">&copy; 2024 TechStore. 保留所有权利。</p>
            <p style="opacity: 0.7;">体验科技，改变生活。</p>
        </div>
    </footer>
    
    <!-- 关键JavaScript内联 -->
    <script>
        // 懒加载实现
        document.addEventListener('DOMContentLoaded', function() {
            const lazyImages = document.querySelectorAll('.lazy-image');
            
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver(function(entries, observer) {
                    entries.forEach(function(entry) {
                        if (entry.isIntersecting) {
                            const image = entry.target;
                            image.src = image.dataset.src;
                            image.classList.remove('lazy-image');
                            imageObserver.unobserve(image);
                        }
                    });
                });
                
                lazyImages.forEach(function(image) {
                    imageObserver.observe(image);
                });
            } else {
                // 回退方案：直接加载所有图片
                lazyImages.forEach(function(image) {
                    image.src = image.dataset.src;
                });
            }
        });
        
        // 性能监控
        window.addEventListener('load', function() {
            // 监控Core Web Vitals
            if ('PerformanceObserver' in window) {
                // LCP监控
                new PerformanceObserver((entryList) => {
                    for (const entry of entryList.getEntries()) {
                        console.log('LCP:', entry.startTime);
                    }
                }).observe({entryTypes: ['largest-contentful-paint']});
                
                // FID监控
                new PerformanceObserver((entryList) => {
                    for (const entry of entryList.getEntries()) {
                        console.log('FID:', entry.processingStart - entry.startTime);
                    }
                }).observe({entryTypes: ['first-input']});
                
                // CLS监控
                let clsValue = 0;
                new PerformanceObserver((entryList) => {
                    for (const entry of entryList.getEntries()) {
                        if (!entry.hadRecentInput) {
                            clsValue += entry.value;
                        }
                    }
                    console.log('CLS:', clsValue);
                }).observe({entryTypes: ['layout-shift']});
            }
            
            // 基本性能指标
            setTimeout(function() {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('页面加载时间:', perfData.loadEventEnd - perfData.navigationStart, 'ms');
                console.log('DOM解析时间:', perfData.domContentLoadedEventEnd - perfData.domLoading, 'ms');
            }, 0);
        });
    </script>
    
    <!-- 非关键JavaScript异步加载 -->
    <script async src="/js/analytics.js"></script>
    <script defer src="/js/non-critical.js"></script>
</body>
</html>
```